<div ng-controller="ManageController" ng-init="searchConsumer()">
	<br>
	<div class="row">
		<div class="col-md-12">
			<div class="panel">
				<div class="panel-body col-md-3">
					<h5>Search Consumer</h5>
					<table class="table table-striped table-bordered table-hover table-responsive">
						<tbody>
							<tr>
								<td>
									<div>
										<label class="control-label">Consumer Category</label><br>
										<div class="form-group" class="visible-lg-inline visible-md-inline visible-sm-inline visible-xs-inline" ng-repeat="conCatFilter in searchConsumerReq.conCatList">
											<a class="panel panel-default" href="#"><strong>{{conCatFilter.name}} : </strong>{{conCatFilter.value}}</a>
											<a class="btn btn-danger btn-xs" title="delete category" ng-click="deleteFilter($index)"><i class="fa fa-minus"></i></a> 
										</div>
										<div class="visible-lg-inline visible-md-inline visible-sm-inline visible-xs-inline">
											<select ng-model="newFilter.name" ng-change="fetchCategoryValues(newFilter.name)">
												<option ng-repeat="category in categories" ng-value="category">{{category}}</option>
											</select>
											<select ng-model="newFilter.value">
												<option ng-repeat="catValue in catValues" ng-value="catValue">{{catValue}}</option>
											</select>
											<a class="btn btn-success btn-xs" title="add filter" ng-click="addFilter(newFilter)"><i class="fa fa-plus"></i></a>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<div class="form-group">
										<label class="control-label">Consumer Email</label>
										<input class="form-control" ng-model="searchConsumerReq.email" placeholder="name@email.com" />
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<div class="form-group">
										<label class="control-label">Consumer Mobile</label>
										<input class="form-control" ng-model="searchConsumerReq.mobile" type="text" placeholder="9999999999" />
									</div>
								</td>
							</tr>
							<tr>
								<td><button ng-click="searchConsumer()" type="button" class="btn btn-info">Search</button></td>
							</tr>
						</tbody>
					</table>
					<hr>
					<h5 ng-if="user.access.finance">Update Consumer</h5>
					<table ng-if="user.access.finance" class="table table-striped table-bordered table-hover table-responsive">
						<tbody>
							<tr>
								<td>
									<div>
										<label class="control-label">New Consumer Category</label><br>
										<div class="form-group" class="visible-lg-inline visible-md-inline visible-sm-inline visible-xs-inline" ng-repeat="conCatFilter in updateConsumerReq.conCatList">
											<a class="panel panel-default" href="#"><strong>{{conCatFilter.name}} : </strong>{{conCatFilter.value}}</a>
											<a class="btn btn-danger btn-xs" title="delete category" ng-click="deleteUpdateFilter($index)"><i class="fa fa-minus"></i></a> 
										</div>
										<div class="visible-lg-inline visible-md-inline visible-sm-inline visible-xs-inline">
											<input placeholder="category name" type="text" ng-model="updateFilter.name" list="update-cat-auto-complete" ng-init="updateFilter.name = ''" /> 
											<datalist id="update-cat-auto-complete">
												<option ng-repeat="updateCat in updateCategories" ng-value="updateCat">
											</datalist>
											<input placeholder="category value" ng-disabled="updateFilter.name == ''" type="text" ng-focus="fetchUpdateCategoryValues(updateFilter.name)" ng-model="updateFilter.value" list="update-value-auto-complete" ng-init="updateFilter.value = ''" /> 
											<datalist id="update-value-auto-complete">
												<option ng-repeat="updateCatValue in updateCatValues" ng-value="updateCatValue">
											</datalist>
											<a class="btn btn-success btn-xs" title="add filter" ng-click="addUpdateFilter(updateFilter)"><i class="fa fa-plus"></i></a>
										</div>
									</div>
								</td>
							</tr>
							<tr>
								<td>
									<table class="table table-striped table-bordered table-responsive">
										<tbody>
											<tr>
												<td><strong>Remove Old Categories</strong></td>
												<td><input ng-model="updateConsumerReq.removeOldTags" type="checkbox"/></td>
											</tr>
											<tr>
												<td><strong>Email On Pay</strong></td>
												<td><input ng-model="updateConsumerReq.emailOnPay" type="checkbox"/></td>
											</tr>
											<tr>
												<td><strong>Email On Refund</strong></td>
												<td><input ng-model="updateConsumerReq.emailOnRefund" type="checkbox"/></td>
											</tr>
											<tr>
												<td><strong>Active</strong></td>
												<td><input ng-model="updateConsumerReq.active" type="checkbox"/></td>
											</tr>
										</tbody>
									</table>
								</td>
							</tr>
							<tr>
								<td><button ng-click="updateConsumerCategory()" type="button" class="btn btn-info">Update</button></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="panel-body col-md-9">
					<div ng-if="user.access.finance" class="row">
						<div class="col-sm-4 col-sm-offset-8">
							<button title="Upload Consumer" ng-click="updateBulkConsumerUploads()" type="button" class="btn btn-basic btn-sm" data-toggle="modal" data-target="#bulkConsumerUploadModal">
								<i class="fa fa-upload"></i> Consumer
							</button>&nbsp;
							<button title="Create Consumer" type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#createConsumerModal">
								<i class="fa fa-plus"></i> Consumer
							</button>
						</div>
					</div>
					<br>
					<table class="table table-bordered table-responsive">
						<thead>
							<tr>
								<td class="text-center"><strong>Name</strong></td>
								<td class="text-center hidden-xs"><strong>Email</strong></td>
								<td class="text-center hidden-xs"><strong>Mobile</strong></td>
								<td class="text-center hidden-xs"><strong>Created By</strong></td>
							</tr>
						</thead>
						<tbody ng-repeat="consumer in consumerResp.consumerList">
							<tr
								ng-class="(consumer.active)?'success':'warning'"
								data-toggle="collapse"
								data-target="#condetails-{{consumer.id}}"
								class="accordion-toggle">
								<td class="text-center">{{consumer.name}}</td>
								<td class="text-center hidden-xs">{{consumer.email}}</td>
								<td class="text-center hidden-xs">{{consumer.mobile}}</td>
								<td class="text-center hidden-xs">{{consumer.createdBy}}</td>
							</tr>
							<tr>
								<td colspan="12" style="padding: 0px; border: 0px;">
									<div style="padding:10px;" class="accordion-body collapse" id="condetails-{{consumer.id}}">
										<div class="row">
											<div class="col-md-12">
												<button title="Add Invoice" type="button"
													class="btn btn-info btn-md hidden-xs"
													ng-if="user.access.finance"
													ng-click="updateInvoiceConsumer(consumer)"
													data-toggle="modal"
													data-target="#createInvoiceModal">
													<i class="fa fa-plus"></i>
												</button>
												<button title="Add Invoice" type="button"
													class="btn btn-info btn-md visible-xs-inline"
													ng-if="user.access.finance"
													ng-click="updateInvoiceConsumer(consumer)"
													data-toggle="modal"
													data-target="#createInvoiceXsModal">
													<i class="fa fa-plus"></i>
												</button>
												<button title="Search Invoice" type="button"
													class="btn btn-success btn-md"
													ng-click="seachConInvoice(consumer)"
													data-target="#invoiceTab"
													data-toggle="tab">
													<i class="fa fa-search"></i>
												</button>
												<a href="#" ng-click="$parent.editConPrefs = !$parent.editConPrefs" ng-if="user.access.finance">
													<span class="btn btn-danger glyphicon glyphicon-edit"></span>
												</a>
												&nbsp;&nbsp;&nbsp;
												<div class="panel visible-lg-inline visible-sm-inline visible-xs-inline" ng-repeat="conCat in consumer.conCats">
													<a href="#"><strong>{{conCat.name}} : </strong>{{conCat.value}}</a>
													<a class="btn btn-danger btn-xs" title="delete category" ng-click="deleteCategory(consumer.id, conCat.id)"><i class="fa fa-minus"></i></a> 
												</div>
											</div>
										</div>
										<br>
										<div class="row">
											<div class="col-lg-6">
												<h5>Consumer Settings</h5>
												<fieldset ng-disabled="!editConPrefs">
													<table class="table table-striped table-bordered table-responsive">
														<tbody>
															<tr>
																<td>
																	<input placeholder="category name" class="form-control" type="text" ng-model="newConCat.name" list="cat-auto-complete" ng-init="newConCat.name = ''" />
																	<datalist id="cat-auto-complete">
																		<option ng-repeat="category in categories" ng-value="category">
																	</datalist>
																</td>
																<td>
																	<div class="row">
																		<div class="col-lg-9 col-md-9 col-sm-9 col-xs-8">
																			<input placeholder="category value" class="form-control" ng-disabled="newConCat.name == ''" type="text" ng-focus="fetchNewCategoryValues(newConCat.name)" ng-model="newConCat.value" list="catValue-auto-complete" ng-init="newConCat.value = ''" /> 
																			<datalist id="catValue-auto-complete">
																				<option ng-repeat="newCatValue in newCatValues" ng-value="newCatValue">
																			</datalist>
																		</div>
																		<div class="col-lg-2 col-md-2 col-sm-2 col-xs-4">
																			<a class="btn btn-success btn-xs" title="add category" ng-click="addCategory(consumer.id, newConCat)"><i class="fa fa-plus"></i></a>
																		</div>
																	</div>
																</td>
															</tr>
															<tr>
																<td><strong>Created</strong></td>
																<td>{{consumer.created | date:'dd-MM-yyyy'}}</td>
															</tr>
															<tr>
																<td><strong>Email On Pay</strong></td>
																<td><input ng-model="consumer.emailOnPay" type="checkbox"/></td>
															</tr>
															<tr>
																<td><strong>Email On Refund</strong></td>
																<td><input ng-model="consumer.emailOnRefund" type="checkbox"/></td>
															</tr>
															<tr>
																<td><strong>Active</strong></td>
																<td><input ng-model="consumer.active" type="checkbox"/></td>
															</tr>
														</tbody>
													</table>
												</fieldset>
											</div>
											<div class="col-lg-6">
												<h5>Address</h5>
												<fieldset ng-disabled="!editConPrefs">
													<table class="table table-striped table-bordered table-responsive">
														<tbody>
															<tr>
																<td><strong>Address Line 1</strong></td>
																<td><input class="form-control" ng-model="consumer.address.addressLine1"/></td>
															</tr>
															<tr>
																<td><strong>Address Line 2</strong></td>
																<td><input class="form-control" ng-model="consumer.address.addressLine2"/></td>
															</tr>
															<tr>
																<td><strong>City</strong> : <input class="form-control" ng-model="consumer.address.city"/></td>
																<td><strong>Disctrict</strong> : <input class="form-control" ng-model="consumer.address.district"/></td>
															</tr>
															<tr>
																<td><strong>State</strong> : <input class="form-control" ng-model="consumer.address.state"/></td>
																<td><strong>Pincode</strong> : <input class="form-control" ng-model="consumer.address.pincode"/></td>
															</tr>
															<tr>
																<td><strong>Country</strong></td>
																<td><input class="form-control" ng-model="consumer.address.country"/></td>
															</tr>
														</tbody>
													</table>
												</fieldset>
											</div>
											<div class="col-lg-6">
												<button type="button" ng-click="updateConsumer(consumer)" class="btn btn-info">Save</button>
											</div>
										</div>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
					<ul class="pagination" style="float:right;">
						<li ng-class="(consumerResp.page <= 1)?'disabled':''" class="paginate_button previous"><a ng-click="(consumerResp.page <= 1) || loadConsumerPage(consumerResp.page-1)" href="#">Previous</a></li>
						<li ng-repeat="page in consumerResp.allPages" ng-class="(page == consumerResp.page)?'active':''"><a ng-click="loadConsumerPage(page)" href="#">{{page}}</a></li>
						<li ng-class="(consumerResp.page >= consumerResp.allPages.length)?'disabled':''" class="paginate_button next"><a ng-click="(consumerResp.page >= consumerResp.allPages.length) || loadConsumerPage(consumerResp.page+1)" href="#">Next</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>